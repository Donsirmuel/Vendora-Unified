import{be as V,r as u,j as e,aH as H,aJ as W,bg as z,bh as G,aV as J,aG as k,b7 as L,bd as K}from"./vendor-LI3anQjP.js";import{L as S,B as N}from"./badge-0Mmftv1n.js";import{C as c,a as l,b as i,d as h,e as m}from"./charts_panel-DZ6GAu93.js";import{a as X,u as q,B as v,L as Q,I as Y,h as p,g,t as Z}from"./main-Dx6KqeX5.js";import{f as ee}from"./currency-CzyHyq4G.js";import"./vendor-recharts-iVWv7ny2.js";const ne=()=>{const{id:o}=V(),{toast:n}=X(),{user:T}=q(),F=T?.currency||"USD",[y,w]=u.useState(!1),[_,C]=u.useState(!1),[t,f]=u.useState(null),[d,P]=u.useState(null),U="https://api.vendora.page",j=s=>s?s.startsWith("http://")||s.startsWith("https://")?s:s.startsWith("/")?`${U}${s}`:s:"";u.useEffect(()=>{(async()=>{if(o)try{const r=await p.get(`/api/v1/transactions/${o}/`);if(f(r.data),r.data?.order)try{const a=await p.get(`/api/v1/orders/${r.data.order}/`);P(a.data)}catch{}}catch(r){n({title:"Load failed",description:g(r,"Could not load transaction"),variant:"destructive"})}})()},[o]);const $=async()=>{C(!0);try{if(!o)return;const s=new FormData;s.append("status","completed");const r=await p.post(`/api/v1/transactions/${o}/complete/`,s,{headers:{"Content-Type":"multipart/form-data"}});n({title:"Transaction Completed",description:"Marked as completed.",className:"bg-success text-success-foreground"});const a=await p.get(`/api/v1/transactions/${o}/`);f(a.data)}catch(s){n({title:"Complete failed",description:g(s,"Failed to complete"),variant:"destructive"})}finally{C(!1)}},A=async s=>{const r=s.target.files;if(!(!r||r.length===0)){w(!0);try{if(!o)return;const a=new FormData;a.append("status","completed"),a.append("vendor_proof",r[0]),await p.post(`/api/v1/transactions/${o}/complete/`,a,{headers:{"Content-Type":"multipart/form-data"}}),n({title:"Proof Uploaded",description:"Vendor proof uploaded and transaction completed.",className:"bg-success text-success-foreground"});const b=await p.get(`/api/v1/transactions/${o}/`);f(b.data)}catch(a){n({title:"Upload failed",description:g(a,"Failed to upload proof"),variant:"destructive"})}finally{w(!1)}}},B=async()=>{try{if(!o)return;const s="https://api.vendora.page",r=Z.getAccessToken()||"",a=await fetch(`${s}/api/v1/transactions/${o}/pdf/`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok){const R=await a.text();throw new Error(R||"Failed to generate PDF")}const b=await a.blob(),D=window.URL.createObjectURL(b),x=document.createElement("a");x.href=D,x.download=`transaction_${o}.pdf`,document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(D)}catch(s){n({title:"PDF Error",description:g(s,"Failed to download PDF"),variant:"destructive"})}},E=s=>{switch(s){case"completed":return"bg-crypto-green/20 text-crypto-green";case"uncompleted":return"bg-warning/20 text-warning";case"declined":return"bg-destructive/20 text-destructive";case"expired":return"bg-gray-100 text-gray-800";default:return"bg-secondary text-secondary-foreground"}},I=s=>{switch(s){case"completed":return e.jsx(k,{className:"h-4 w-4"});case"uncompleted":return e.jsx(L,{className:"h-4 w-4"});case"declined":return e.jsx(K,{className:"h-4 w-4"});default:return e.jsx(L,{className:"h-4 w-4"})}},O=s=>s==="buy"?"bg-crypto-green/20 text-crypto-green":"bg-crypto-red/20 text-crypto-red",M=s=>{switch(s){case"BTC":return"bg-crypto-gold/20 text-crypto-gold";case"ETH":return"bg-crypto-blue/20 text-crypto-blue";default:return"bg-secondary text-secondary-foreground"}};return t?e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(H,{to:"/transactions",children:e.jsxs(v,{variant:"outline",size:"sm",className:"border-border",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Transactions"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Transaction Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete transaction information and actions"})]})]}),e.jsxs(v,{variant:"outline",onClick:B,className:"border-border",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]}),e.jsxs(c,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Transaction Overview"}),e.jsx(h,{children:"Complete details about this transaction"})]}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order ID"}),e.jsx("p",{className:"font-semibold",children:t.order_code||String(t.order).padStart(4,"0")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-semibold",children:d?.created_at?new Date(d.created_at).toLocaleString():t.completed_at?new Date(t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Asset"}),e.jsx(N,{className:M(t.order_asset||""),children:t.order_asset||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-semibold",children:t.order_amount??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Value"}),e.jsx("p",{className:"font-semibold text-lg",children:(()=>{const s=d?.total_value??t.order_total_value,r=s!=null?Number(s):NaN;return isFinite(r)?ee(r,F):"-"})()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(N,{className:O(t.order_type||""),children:(t.order_type||"").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsxs(N,{className:E(t.status),children:[I(t.status),e.jsx("span",{className:"ml-1",children:t.status})]})]})]})})]}),e.jsxs(c,{className:"bg-gradient-card border-border mb-6",children:[e.jsx(l,{children:e.jsx(i,{children:"Customer Details"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Customer Receiving Details"}),e.jsx("div",{className:"p-3 bg-secondary/50 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.customer_receiving_details||"-"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Customer Note"}),e.jsx("div",{className:"p-3 bg-secondary/50 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.customer_note||"-"})})]})]})]}),e.jsxs(c,{className:"bg-gradient-card border-border mb-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Customer Proof of Transaction"}),e.jsx(h,{children:"Payment proof uploaded by customer"})]}),e.jsx(m,{children:(()=>{const s=j(t.proof||t.proof_of_payment||t.customer_proof||null);return s?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 border rounded-lg bg-secondary/30",children:e.jsx("img",{src:s,alt:"Customer proof",className:"max-h-96 object-contain mx-auto"})}),e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-sm underline text-primary",children:"Open original"})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No customer proof uploaded yet"})]})})()})]}),t.status!=="declined"&&e.jsxs(c,{className:"bg-gradient-card border-border mb-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Vendor Actions"}),e.jsx(h,{children:"Available actions for this transaction"})]}),e.jsxs(m,{className:"space-y-4",children:[t.status==="uncompleted"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{onClick:$,disabled:_,className:"w-full bg-gradient-success hover:opacity-90",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),_?"Processing...":"Mark as Completed"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"proof-upload",className:"text-sm font-medium",children:"Upload Proof of Transaction"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{id:"proof-upload",type:"file",accept:"image/*",onChange:A,disabled:y,className:"bg-background border-border file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-primary file:text-primary-foreground hover:file:opacity-90"}),y&&e.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-md",children:e.jsx("div",{className:"text-sm",children:"Uploading..."})})]})]})]}),t.status==="completed"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(k,{className:"h-12 w-12 text-success mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction completed successfully"})]})]})]}),e.jsxs(c,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Transaction Timeline"}),e.jsx(h,{children:"Key timestamps for this transaction"})]}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsx("p",{className:"font-medium",children:d?.created_at?new Date(d.created_at).toLocaleString():t.completed_at?new Date(t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accepted"}),e.jsx("p",{className:"font-medium",children:d?.accepted_at?new Date(d.accepted_at).toLocaleString():d?.status==="completed"&&(t.vendor_completed_at||t.completed_at)?new Date(t.vendor_completed_at||t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"font-medium",children:t.vendor_completed_at?new Date(t.vendor_completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Declined"}),e.jsx("p",{className:"font-medium",children:d?.declined_at?new Date(d.declined_at).toLocaleString():t.status==="declined"&&(t.completed_at||d?.updated_at)?new Date(t.completed_at||d?.updated_at).toLocaleString():"-"})]})]})})]}),t.status!=="declined"&&e.jsxs(c,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Vendor Proof of Completion"}),e.jsx(h,{children:"Proof images uploaded by you"})]}),e.jsx(m,{children:t.vendor_proof?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 border rounded-lg bg-secondary/30",children:e.jsx("img",{src:j(t.vendor_proof),alt:"Vendor proof",className:"max-h-96 object-contain mx-auto"})}),e.jsx("a",{href:j(t.vendor_proof),target:"_blank",rel:"noreferrer",className:"text-sm underline text-primary",children:"Open original"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No vendor proof uploaded yet"})})]})]})}):e.jsx(S,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loadingâ€¦"})})};export{ne as default};
