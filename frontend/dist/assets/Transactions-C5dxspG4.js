import{r as l,j as e,bf as N,bc as H,aH as w}from"./vendor-C5ZIaFXU.js";import{L as A,B as D}from"./badge-CwdvftBL.js";import{c,C as v,a as C,b as S,e as T}from"./charts_panel-CXTnZd3F.js";import{B as h,I,h as F}from"./main-BnmLXDMO.js";import{c as O}from"./sse-C4Am9NwZ.js";import{B as $}from"./BrandedEmptyState-Dd66voyI.js";import"./vendor-recharts-Bhh5Wr_H.js";const k=l.forwardRef(({className:r,...a},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:c("w-full caption-bottom text-sm",r),...a})}));k.displayName="Table";const _=l.forwardRef(({className:r,...a},t)=>e.jsx("thead",{ref:t,className:c("[&_tr]:border-b",r),...a}));_.displayName="TableHeader";const R=l.forwardRef(({className:r,...a},t)=>e.jsx("tbody",{ref:t,className:c("[&_tr:last-child]:border-0",r),...a}));R.displayName="TableBody";const q=l.forwardRef(({className:r,...a},t)=>e.jsx("tfoot",{ref:t,className:c("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...a}));q.displayName="TableFooter";const u=l.forwardRef(({className:r,...a},t)=>e.jsx("tr",{ref:t,className:c("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...a}));u.displayName="TableRow";const n=l.forwardRef(({className:r,...a},t)=>e.jsx("th",{ref:t,className:c("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...a}));n.displayName="TableHead";const i=l.forwardRef(({className:r,...a},t)=>e.jsx("td",{ref:t,className:c("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...a}));i.displayName="TableCell";const P=l.forwardRef(({className:r,...a},t)=>e.jsx("caption",{ref:t,className:c("mt-4 text-sm text-muted-foreground",r),...a}));P.displayName="TableCaption";const K=()=>{const[r,a]=l.useState([]),[t,p]=l.useState(!0),[m,b]=l.useState(""),[d,j]=l.useState(""),[L,f]=l.useState(0),x=async()=>{try{p(!0);const s=new URL("/api/v1/transactions/","https://api.vendora.page");d&&s.searchParams.set("status",d);const o=await F.get(`${s.pathname}${s.search}`);if(a(o.data.results||[]),d==="completed"||!d){const z=new Date().toISOString().slice(0,10),E=(o.data.results||[]).filter(y=>y.completed_at&&String(y.completed_at).slice(0,10)===z).length;f(E)}else f(0)}catch{a([])}finally{p(!1)}};l.useEffect(()=>{x();const s=O("/api/v1/stream/",{onMessage:o=>{o.type==="snapshot"&&x()}});return()=>s.close()},[d]);const g=r.filter(s=>{const o=m.toLowerCase();return String(s.id).includes(o)||(s.order_code||String(s.order)).toLowerCase().includes(o)||(s.status||"").toLowerCase().includes(o)||(s.order_type||"").toLowerCase().includes(o)||(s.order_asset||"").toLowerCase().includes(o)}),B=s=>{const o={uncompleted:"bg-warning/20 text-warning",completed:"bg-crypto-green/20 text-crypto-green",declined:"bg-destructive/20 text-destructive",expired:"bg-gray-100 text-gray-800"};return e.jsx(D,{className:o[s]||"bg-secondary text-secondary-foreground",children:s})};return e.jsx(A,{title:"Transactions",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs(v,{className:"border-border/70",children:[e.jsx(C,{children:e.jsx(S,{className:"text-sm",children:"Transactions released today"})}),e.jsxs(T,{children:[e.jsx("div",{className:"text-2xl font-bold",children:L}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Desk settlements finalized in the current view."})]})]})}),e.jsxs(v,{className:"border-border/70",children:[e.jsxs(C,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-lg font-semibold text-white",children:"Settlement queue"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track every payout and release across your OTC desk."})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:x,disabled:t,className:"border-primary/40 text-primary hover:bg-primary/10",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),t?"Syncing...":"Sync settlements"]})]}),e.jsxs(T,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{key:"",label:"All"},{key:"uncompleted",label:"Uncompleted"},{key:"completed",label:"Completed"},{key:"declined",label:"Declined"},{key:"expired",label:"Expired"}].map(s=>e.jsx(h,{size:"sm",variant:d===s.key?"default":"outline",onClick:()=>j(s.key),children:s.label},s.key||"all"))}),e.jsxs("div",{className:"max-w-md relative mb-4",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by id, order, status",value:m,onChange:s=>b(s.target.value),className:"pl-10"})]}),t?e.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Loading transactions…"}):g.length===0?e.jsx($,{icon:N,title:d||m?"No transactions match this view":"No settlements pending",description:d||m?"Adjust your filters or run a broader search to review historical settlements.":"Once buyers submit proofs or cash hits your accounts, settlements will appear here.",badge:d||m?"Filters applied":"Queue clear",actions:e.jsxs(e.Fragment,{children:[(d||m)&&e.jsx(h,{size:"sm",variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",onClick:()=>{j(""),b(""),x()},children:"Reset filters"}),e.jsx(w,{to:"/orders",children:e.jsx(h,{size:"sm",className:"bg-gradient-primary text-primary-foreground",children:"Review pending orders"})})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(_,{children:e.jsxs(u,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Order Code"}),e.jsx(n,{children:"Asset"}),e.jsx(n,{children:"Amount"}),e.jsx(n,{children:"Value (₦)"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Completed At"}),e.jsx(n,{children:"Proof"})]})}),e.jsx(R,{children:g.map(s=>e.jsxs(u,{className:"hover:bg-muted/40",children:[e.jsx(i,{children:e.jsx(w,{to:`/transactions/${s.id}`,className:"text-primary underline",children:String(s.id).padStart(4,"0")})}),e.jsx(i,{className:"capitalize",children:s.order_type||"-"}),e.jsx(i,{children:s.order_code||s.order}),e.jsx(i,{children:s.order_asset||"-"}),e.jsx(i,{children:s.order_amount??"-"}),e.jsx(i,{children:s.order_total_value!=null?`₦${Number(s.order_total_value).toLocaleString()}`:"-"}),e.jsx(i,{children:B(s.status)}),e.jsx(i,{className:"text-muted-foreground",children:s.completed_at?new Date(s.completed_at).toLocaleString():"-"}),e.jsx(i,{children:s.proof?"Yes":"No"})]},s.id))})]})})]})]})]})})};export{K as default};
