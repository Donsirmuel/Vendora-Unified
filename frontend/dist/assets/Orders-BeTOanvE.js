import{r,j as e,ba as U,bb as q,bc as W,aH as L,b4 as X,b9 as O,b8 as $,bd as G,b7 as J}from"./vendor-LI3anQjP.js";import{L as E,B as K}from"./badge-0Mmftv1n.js";import{C as F,a as Q,b as Y,e as k}from"./charts_panel-DZ6GAu93.js";import{a as Z,u as ee,g as b,B as n,I as se}from"./main-Dx6KqeX5.js";import{S as te,a as ae,b as re,c as ie,d as c}from"./select-6GBzacIP.js";import{l as le,a as ne,d as ce}from"./orders-BTsnZsY7.js";import{c as de}from"./sse-BitM5vLy.js";import{f as B}from"./currency-CzyHyq4G.js";import{F as oe,a as me}from"./FreePlanComponents-A75r-WAZ.js";import{B as xe}from"./BrandedEmptyState-3fXBKWGy.js";import"./vendor-recharts-iVWv7ny2.js";const we=()=>{const{toast:d}=Z(),{user:D}=ee(),v=D?.currency||"USD",[h,m]=r.useState([]),[p,I]=r.useState([]),[j,N]=r.useState(!0),[i,y]=r.useState(""),[l,C]=r.useState("pending"),[x,g]=r.useState(1),[R,T]=r.useState(!0),[w,u]=r.useState(null);r.useEffect(()=>{f();const s=de("/api/v1/stream/",{onMessage:t=>{t.type==="snapshot"&&(g(1),f())}});return()=>s.close()},[x]),r.useEffect(()=>{P()},[h,i,l]);const f=async()=>{try{N(!0);const s=await le(x,"pending");m(x===1?s.results:t=>[...t,...s.results]),T(!!s.next)}catch(s){d({title:"Error",description:b(s,"Failed to load orders"),className:"bg-destructive text-destructive-foreground"})}finally{N(!1)}},P=()=>{let s=[...h];if(l!=="all"&&(s=s.filter(t=>t.status===l)),i){const t=i.toLowerCase();s=s.filter(a=>a.asset&&a.asset.toLowerCase().includes(t)||a.type&&a.type.toLowerCase().includes(t)||String(a.amount).toLowerCase().includes(t)||a.rate!==void 0&&String(a.rate).toLowerCase().includes(t))}I(s)},V=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:J,text:"Pending"},accepted:{color:"bg-blue-100 text-blue-800",icon:O,text:"Accepted"},declined:{color:"bg-red-100 text-red-800",icon:G,text:"Declined"},expired:{color:"bg-gray-100 text-gray-800",icon:$,text:"Expired"},completed:{color:"bg-green-100 text-green-800",icon:O,text:"Completed"}},a=t[s]||t.pending,o=a.icon;return e.jsxs(K,{className:a.color,children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),a.text]})},_=s=>new Date(s).toLocaleString(),M=s=>s==="buy"?e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"B"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-semibold text-sm",children:"S"})}),S=()=>{g(1),y(""),C("pending"),f()},z=async s=>{try{u(s.id);const t=await ne(s.id,{});m(a=>a.filter(o=>o.id!==s.id)),d({title:"Accepted",description:"Order accepted and customer notified."})}catch(t){d({title:"Accept failed",description:b(t,"Could not accept order"),variant:"destructive"})}finally{u(null)}},H=async s=>{try{u(s.id);const t=window.prompt("Enter reason for declining:")||"No reason provided",a=await ce(s.id,{rejection_reason:t});m(o=>o.map(A=>A.id===s.id?a:A)),d({title:"Declined",description:"Customer notified of decline."})}catch(t){d({title:"Decline failed",description:b(t,"Could not decline order"),variant:"destructive"})}finally{u(null)}};return j&&x===1?e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading orders..."})]})})}):e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(oe,{}),e.jsx(me,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Orders dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Approve buyers, complete payments, and keep your deals moving in real time."})]}),e.jsxs(n,{onClick:S,variant:"outline",className:"border-primary/40 text-primary hover:bg-primary/10",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Resync pending orders"]})]}),e.jsxs(F,{className:"border-border/70",children:[e.jsx(Q,{children:e.jsxs(Y,{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(se,{placeholder:"Search orders...",value:i,onChange:s=>y(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(te,{value:l,onValueChange:C,children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"All statuses"})}),e.jsxs(ie,{children:[e.jsx(c,{value:"all",children:"All Statuses"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"accepted",children:"Accepted"}),e.jsx(c,{value:"declined",children:"Declined"}),e.jsx(c,{value:"expired",children:"Expired"}),e.jsx(c,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Results"}),e.jsxs("div",{className:"text-sm text-muted-foreground pt-2",children:[p.length," of ",h.length," orders"]})]})]})})]}),e.jsx("div",{className:"space-y-4",children:p.length>0?p.map(s=>e.jsx(F,{className:"hover:shadow-md transition-shadow",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[M(s.type),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[s.asset," ",s.type.toUpperCase()]}),V(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("p",{className:"font-medium",children:[s.amount," ",s.asset]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Rate:"}),e.jsx("p",{className:"font-medium",children:B(Number(s.rate||0),v)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Value:"}),e.jsx("p",{className:"font-medium",children:s.total_value!=null?B(Number(s.total_value||0),v):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("p",{className:"font-medium",children:_(s.created_at)})]})]}),s.rejection_reason&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",s.rejection_reason]})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(L,{to:`/orders/${s.id}`,children:e.jsx(n,{variant:"outline",size:"sm",children:"View Details"})}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>z(s),disabled:w===s.id,children:"Accept"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>H(s),disabled:w===s.id,children:"Decline"})]})]})]})})},s.id)):e.jsx(xe,{icon:X,title:i||l!=="all"?"No orders match your filters":"No orders waiting on you",description:i||l!=="all"?"Reset your filters to view the latest buyer requests waiting in Vendora.":"Share your Vendora bot link or broadcast fresh rates to bring in new orders.",badge:i||l!=="all"?"Filters applied":"Inbox clear",actions:e.jsxs(e.Fragment,{children:[(i||l!=="all")&&e.jsx(n,{onClick:S,variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Clear filters"}),e.jsx(L,{to:"/broadcast-messages",children:e.jsx(n,{className:"bg-gradient-primary text-primary-foreground",children:"Broadcast updated rates"})})]})})}),R&&e.jsx("div",{className:"flex justify-center",children:e.jsx(n,{onClick:()=>g(s=>s+1),disabled:j,variant:"outline",children:j?"Loading...":"Load More Orders"})})]})})};export{we as default};
