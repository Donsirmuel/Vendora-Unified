import{be as X,aB as G,r as n,j as e,aH as Q,aJ as W,bf as Y,aV as Z,an as ee}from"./vendor-C5ZIaFXU.js";import{L as S,B as b}from"./badge-CwdvftBL.js";import{C as _,a as k,b as A,d as O,e as D}from"./charts_panel-CXTnZd3F.js";import{a as se,B as p,I as te,g as N}from"./main-BnmLXDMO.js";import{S as re,a as ae,b as ne,c as ce,d as de}from"./select-D7oLnaqY.js";import{T as B}from"./textarea-B39yKq_J.js";import{g as $,a as oe,d as ie}from"./orders-BRpWy8Bz.js";import{l as le,a as ue}from"./rates-DrUr7xMo.js";import"./vendor-recharts-Bhh5Wr_H.js";const ve=()=>{const{id:o}=X(),R=G(),{toast:c}=se(),[t,l]=n.useState(null),[T,y]=n.useState(!0),[h,L]=n.useState(""),[g,E]=n.useState(""),[u,i]=n.useState(!1),[j,I]=n.useState([]),[me,P]=n.useState([]),[m,V]=n.useState(""),[f,v]=n.useState("");n.useEffect(()=>{(async()=>{try{if(!o)return;y(!0);const r=await $(Number(o));l(r);try{const[a,d]=await Promise.all([le(1),ue(1)]);if(I(a.results||[]),P(d.results||[]),r.type==="sell"){const x=(d.results||[]).find(M=>{var C,w;return((C=M.asset)==null?void 0:C.toUpperCase())===((w=r.asset)==null?void 0:w.toUpperCase())});x!=null&&x.contract_address&&v(x.contract_address)}}catch{}}catch(r){c({title:"Load Error",description:N(r,"Failed to load order"),variant:"destructive"})}finally{y(!1)}})()},[o]);const F=async()=>{try{if(!t)return;i(!0);const s={};if(g&&(s.acceptance_note=g),t.type==="buy"){const a=j.find(d=>String(d.id)===m);if(a){const d=`${a.bank_name}
${a.account_name}
${a.account_number}${a.instructions?`
${a.instructions}`:""}`;s.pay_instructions=d}}else f&&(s.send_instructions=f.trim());const r=await oe(t.id,s);l(r),c({title:"Accepted",description:"Customer has been notified with payment details."})}catch(s){c({title:"Accept Error",description:N(s,"Failed to accept order"),variant:"destructive"})}finally{i(!1)}},H=async()=>{try{if(!t)return;if(i(!0),!h.trim()){c({title:"Reason required",description:"Provide a brief reason to decline."}),i(!1);return}const s=await ie(t.id,{rejection_reason:h.trim()});l(s),c({title:"Declined",description:"Customer has been notified."}),R("/orders")}catch(s){c({title:"Decline Error",description:N(s,"Failed to decline order"),variant:"destructive"})}finally{i(!1)}},U=s=>s==="buy"?"bg-crypto-green/20 text-crypto-green":"bg-crypto-red/20 text-crypto-red",q=s=>{switch(s){case"BTC":return"bg-crypto-gold/20 text-crypto-gold";case"ETH":return"bg-crypto-blue/20 text-crypto-blue";default:return"bg-secondary text-secondary-foreground"}},z=s=>{const r={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",declined:"bg-red-100 text-red-800",expired:"bg-gray-100 text-gray-800",completed:"bg-green-100 text-green-800"},a=r[s]||r.pending;return e.jsx(b,{className:a,children:s})};if(T||!t)return e.jsx(S,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading order…"})});const J=t.order_code||String(t.id),K=t.total_value!=null?`₦${Number(t.total_value).toLocaleString()}`:"-";return e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Q,{to:"/orders",children:e.jsxs(p,{variant:"outline",size:"sm",className:"border-border",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Orders"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Order Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and respond to this order"})]}),e.jsx("div",{className:"ml-auto flex gap-2",children:e.jsxs(p,{variant:"outline",onClick:()=>o&&$(Number(o)).then(l),className:"border-border",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsxs(_,{className:"bg-gradient-card border-border",children:[e.jsxs(k,{children:[e.jsx(A,{children:"Transaction Overview"}),e.jsx(O,{children:"Key details about this order"})]}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order ID"}),e.jsx("p",{className:"font-semibold",children:J})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-semibold",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Asset"}),e.jsx(b,{className:q(t.asset),children:t.asset})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"font-semibold",children:[t.amount," ",t.asset]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Value"}),e.jsx("p",{className:"font-semibold text-lg",children:K})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(b,{className:U(t.type),children:t.type.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),z(t.status)]})]})})]}),e.jsxs(_,{className:"bg-gradient-card border-border",children:[e.jsxs(k,{children:[e.jsx(A,{children:"Vendor Actions"}),e.jsx(O,{children:"Choose your response to this order"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-success"}),e.jsx("span",{children:"Accept Order"})]}),t.type==="buy"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select Bank Account to send as payment instructions"}),e.jsxs(re,{value:m,onValueChange:V,children:[e.jsx(ae,{children:e.jsx(ne,{placeholder:"Choose a bank account"})}),e.jsx(ce,{children:j.map(s=>e.jsxs(de,{value:String(s.id),children:[s.bank_name," • ",s.account_number," • ",s.account_name]},s.id))})]}),m&&e.jsx("div",{className:"p-3 bg-secondary/40 rounded text-sm whitespace-pre-wrap",children:(()=>{const s=j.find(r=>String(r.id)===m);return s?`${s.bank_name}
${s.account_name}
${s.account_number}${s.instructions?`
${s.instructions}`:""}`:null})()})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Destination Address (contract or wallet)"}),e.jsx(te,{value:f,onChange:s=>v(s.target.value),placeholder:"0x... or network:address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optional: Acceptance Note (will be sent to customer)"}),e.jsx(B,{value:g,onChange:s=>E(s.target.value),placeholder:"Any note for the customer"})]}),e.jsx(p,{onClick:F,disabled:u,className:"w-full bg-gradient-success hover:opacity-90",children:u?"Processing...":"Accept Order"})]}),e.jsx("div",{className:"border-t border-border pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center space-x-2",children:[e.jsx(ee,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{children:"Decline Order"})]}),e.jsx(B,{placeholder:"Optional: Reason for declining (will be sent to customer)",value:h,onChange:s=>L(s.target.value),className:"bg-background border-border"}),e.jsx(p,{variant:"destructive",onClick:H,disabled:u,className:"w-full",children:u?"Processing...":"Decline Order"})]})})]})]})]})})};export{ve as default};
