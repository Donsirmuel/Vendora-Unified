import{be as X,aB as G,r as c,j as e,aH as Q,aJ as W,bf as Y,aV as Z,an as ee}from"./vendor-LI3anQjP.js";import{L as C,B as f}from"./badge-0Mmftv1n.js";import{C as w,a as S,b as _,d as k,e as A}from"./charts_panel-DZ6GAu93.js";import{a as se,u as te,B as x,I as re,g as b}from"./main-Dx6KqeX5.js";import{S as ae,a as ce,b as ne,c as de,d as oe}from"./select-6GBzacIP.js";import{T as D}from"./textarea-BkG9H_Pj.js";import{g as O,a as ie,d as le}from"./orders-BTsnZsY7.js";import{l as ue,a as me}from"./rates-C4sKvACh.js";import{f as xe}from"./currency-CzyHyq4G.js";import"./vendor-recharts-iVWv7ny2.js";const Se=()=>{const{id:o}=X(),B=G(),{toast:n}=se(),{user:R}=te(),T=R?.currency||"USD",[t,l]=c.useState(null),[$,y]=c.useState(!0),[p,E]=c.useState(""),[h,L]=c.useState(""),[u,i]=c.useState(!1),[g,I]=c.useState([]),[pe,P]=c.useState([]),[m,V]=c.useState(""),[j,N]=c.useState("");c.useEffect(()=>{(async()=>{try{if(!o)return;y(!0);const r=await O(Number(o));l(r);try{const[a,d]=await Promise.all([ue(1),me(1)]);if(I(a.results||[]),P(d.results||[]),r.type==="sell"){const v=(d.results||[]).find(M=>M.asset?.toUpperCase()===r.asset?.toUpperCase());v?.contract_address&&N(v.contract_address)}}catch{}}catch(r){n({title:"Load Error",description:b(r,"Failed to load order"),variant:"destructive"})}finally{y(!1)}})()},[o]);const U=async()=>{try{if(!t)return;i(!0);const s={};if(h&&(s.acceptance_note=h),t.type==="buy"){const a=g.find(d=>String(d.id)===m);if(a){const d=`${a.bank_name}
${a.account_name}
${a.account_number}${a.instructions?`
${a.instructions}`:""}`;s.pay_instructions=d}}else j&&(s.send_instructions=j.trim());const r=await ie(t.id,s);l(r),n({title:"Accepted",description:"Customer has been notified with payment details."})}catch(s){n({title:"Accept Error",description:b(s,"Failed to accept order"),variant:"destructive"})}finally{i(!1)}},F=async()=>{try{if(!t)return;if(i(!0),!p.trim()){n({title:"Reason required",description:"Provide a brief reason to decline."}),i(!1);return}const s=await le(t.id,{rejection_reason:p.trim()});l(s),n({title:"Declined",description:"Customer has been notified."}),B("/orders")}catch(s){n({title:"Decline Error",description:b(s,"Failed to decline order"),variant:"destructive"})}finally{i(!1)}},H=s=>s==="buy"?"bg-crypto-green/20 text-crypto-green":"bg-crypto-red/20 text-crypto-red",q=s=>{switch(s){case"BTC":return"bg-crypto-gold/20 text-crypto-gold";case"ETH":return"bg-crypto-blue/20 text-crypto-blue";default:return"bg-secondary text-secondary-foreground"}},z=s=>{const r={pending:"bg-yellow-100 text-yellow-800",accepted:"bg-blue-100 text-blue-800",declined:"bg-red-100 text-red-800",expired:"bg-gray-100 text-gray-800",completed:"bg-green-100 text-green-800"},a=r[s]||r.pending;return e.jsx(f,{className:a,children:s})};if($||!t)return e.jsx(C,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading order…"})});const J=t.order_code||String(t.id),K=t.total_value!=null?xe(Number(t.total_value),T):"-";return e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Q,{to:"/orders",children:e.jsxs(x,{variant:"outline",size:"sm",className:"border-border",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Back to Orders"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Order Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and respond to this order"})]}),e.jsx("div",{className:"ml-auto flex gap-2",children:e.jsxs(x,{variant:"outline",onClick:()=>o&&O(Number(o)).then(l),className:"border-border",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),e.jsxs(w,{className:"bg-gradient-card border-border",children:[e.jsxs(S,{children:[e.jsx(_,{children:"Transaction Overview"}),e.jsx(k,{children:"Key details about this order"})]}),e.jsx(A,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order ID"}),e.jsx("p",{className:"font-semibold",children:J})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-semibold",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Asset"}),e.jsx(f,{className:q(t.asset),children:t.asset})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsxs("p",{className:"font-semibold",children:[t.amount," ",t.asset]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Value"}),e.jsx("p",{className:"font-semibold text-lg",children:K})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(f,{className:H(t.type),children:t.type.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),z(t.status)]})]})})]}),e.jsxs(w,{className:"bg-gradient-card border-border",children:[e.jsxs(S,{children:[e.jsx(_,{children:"Vendor Actions"}),e.jsx(k,{children:"Choose your response to this order"})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-success"}),e.jsx("span",{children:"Accept Order"})]}),t.type==="buy"?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select Bank Account to send as payment instructions"}),e.jsxs(ae,{value:m,onValueChange:V,children:[e.jsx(ce,{children:e.jsx(ne,{placeholder:"Choose a bank account"})}),e.jsx(de,{children:g.map(s=>e.jsxs(oe,{value:String(s.id),children:[s.bank_name," • ",s.account_number," • ",s.account_name]},s.id))})]}),m&&e.jsx("div",{className:"p-3 bg-secondary/40 rounded text-sm whitespace-pre-wrap",children:(()=>{const s=g.find(r=>String(r.id)===m);return s?`${s.bank_name}
${s.account_name}
${s.account_number}${s.instructions?`
${s.instructions}`:""}`:null})()})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Destination Address (contract or wallet)"}),e.jsx(re,{value:j,onChange:s=>N(s.target.value),placeholder:"0x... or network:address"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Optional: Acceptance Note (will be sent to customer)"}),e.jsx(D,{value:h,onChange:s=>L(s.target.value),placeholder:"Any note for the customer"})]}),e.jsx(x,{onClick:U,disabled:u,className:"w-full bg-gradient-success hover:opacity-90",children:u?"Processing...":"Accept Order"})]}),e.jsx("div",{className:"border-t border-border pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center space-x-2",children:[e.jsx(ee,{className:"h-4 w-4 text-destructive"}),e.jsx("span",{children:"Decline Order"})]}),e.jsx(D,{placeholder:"Optional: Reason for declining (will be sent to customer)",value:p,onChange:s=>E(s.target.value),className:"bg-background border-border"}),e.jsx(x,{variant:"destructive",onClick:F,disabled:u,className:"w-full",children:u?"Processing...":"Decline Order"})]})})]})]})]})})};export{Se as default};
