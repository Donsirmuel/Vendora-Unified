import{b as p}from"./main-Dx6KqeX5.js";function f(l="/api/v1/stream/",n={}){let e=null,s=!1,o=1e3;const c=()=>{if(s)return;const r=new URL(l,window.location.origin),i=p();i&&r.searchParams.set("token",i),e=new EventSource(r.toString(),{withCredentials:!1}),e.onopen=()=>{o=1e3,n.onOpen?.()},e.onerror=t=>{n.onError?.(t);try{e?.close()}catch{}e=null,s||(setTimeout(c,o),o=Math.min(o*2,3e4))},e.addEventListener("snapshot",t=>{try{const a=JSON.parse(t.data);n.onMessage?.({type:"snapshot",data:a})}catch{}}),e.onmessage=t=>{try{const a=JSON.parse(t.data);n.onMessage?.({type:"message",data:a})}catch{}}};return c(),{close:()=>{s=!0;try{e?.close()}catch{}e=null}}}export{f as c};
