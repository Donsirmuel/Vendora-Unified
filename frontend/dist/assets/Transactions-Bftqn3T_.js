import{r as l,j as e,bf as v,bc as D,aH as C}from"./vendor-LI3anQjP.js";import{L as I,B as F}from"./badge-0Mmftv1n.js";import{c as i,C as S,a as T,b as _,e as k}from"./charts_panel-DZ6GAu93.js";import{u as P,B as u,I as O,h as U}from"./main-Dx6KqeX5.js";import{c as $}from"./sse-BitM5vLy.js";import{f as q}from"./currency-CzyHyq4G.js";import{B as M}from"./BrandedEmptyState-3fXBKWGy.js";import"./vendor-recharts-iVWv7ny2.js";const R=l.forwardRef(({className:t,...a},r)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:r,className:i("w-full caption-bottom text-sm",t),...a})}));R.displayName="Table";const L=l.forwardRef(({className:t,...a},r)=>e.jsx("thead",{ref:r,className:i("[&_tr]:border-b",t),...a}));L.displayName="TableHeader";const B=l.forwardRef(({className:t,...a},r)=>e.jsx("tbody",{ref:r,className:i("[&_tr:last-child]:border-0",t),...a}));B.displayName="TableBody";const Q=l.forwardRef(({className:t,...a},r)=>e.jsx("tfoot",{ref:r,className:i("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...a}));Q.displayName="TableFooter";const h=l.forwardRef(({className:t,...a},r)=>e.jsx("tr",{ref:r,className:i("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...a}));h.displayName="TableRow";const n=l.forwardRef(({className:t,...a},r)=>e.jsx("th",{ref:r,className:i("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...a}));n.displayName="TableHead";const c=l.forwardRef(({className:t,...a},r)=>e.jsx("td",{ref:r,className:i("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...a}));c.displayName="TableCell";const V=l.forwardRef(({className:t,...a},r)=>e.jsx("caption",{ref:r,className:i("mt-4 text-sm text-muted-foreground",t),...a}));V.displayName="TableCaption";const se=()=>{const{user:t}=P(),a=t?.currency||"USD",[r,f]=l.useState([]),[p,b]=l.useState(!0),[m,j]=l.useState(""),[d,y]=l.useState(""),[A,g]=l.useState(0),x=async()=>{try{b(!0);const s=new URL("/api/v1/transactions/","https://api.vendora.page");d&&s.searchParams.set("status",d);const o=await U.get(`${s.pathname}${s.search}`);if(f(o.data.results||[]),d==="completed"||!d){const H=new Date().toISOString().slice(0,10),z=(o.data.results||[]).filter(w=>w.completed_at&&String(w.completed_at).slice(0,10)===H).length;g(z)}else g(0)}catch{f([])}finally{b(!1)}};l.useEffect(()=>{x();const s=$("/api/v1/stream/",{onMessage:o=>{o.type==="snapshot"&&x()}});return()=>s.close()},[d]);const N=r.filter(s=>{const o=m.toLowerCase();return String(s.id).includes(o)||(s.order_code||String(s.order)).toLowerCase().includes(o)||(s.status||"").toLowerCase().includes(o)||(s.order_type||"").toLowerCase().includes(o)||(s.order_asset||"").toLowerCase().includes(o)}),E=s=>{const o={uncompleted:"bg-warning/20 text-warning",completed:"bg-crypto-green/20 text-crypto-green",declined:"bg-destructive/20 text-destructive",expired:"bg-gray-100 text-gray-800"};return e.jsx(F,{className:o[s]||"bg-secondary text-secondary-foreground",children:s})};return e.jsx(I,{title:"Transactions",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs(S,{className:"border-border/70",children:[e.jsx(T,{children:e.jsx(_,{className:"text-sm",children:"Transactions released today"})}),e.jsxs(k,{children:[e.jsx("div",{className:"text-2xl font-bold",children:A}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Payments completed in the current view."})]})]})}),e.jsxs(S,{className:"border-border/70",children:[e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-lg font-semibold text-white",children:"Payments queue"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Track every payout across your orders."})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:x,disabled:p,className:"border-primary/40 text-primary hover:bg-primary/10",children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),p?"Syncing...":"Sync payments"]})]}),e.jsxs(k,{children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:[{key:"",label:"All"},{key:"uncompleted",label:"Uncompleted"},{key:"completed",label:"Completed"},{key:"declined",label:"Declined"},{key:"expired",label:"Expired"}].map(s=>e.jsx(u,{size:"sm",variant:d===s.key?"default":"outline",onClick:()=>y(s.key),children:s.label},s.key||"all"))}),e.jsxs("div",{className:"max-w-md relative mb-4",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search by id, order, status",value:m,onChange:s=>j(s.target.value),className:"pl-10"})]}),p?e.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Loading transactionsâ€¦"}):N.length===0?e.jsx(M,{icon:v,title:d||m?"No transactions match this view":"No payments pending",description:d||m?"Adjust your filters or run a broader search to review past payments.":"Once buyers submit proofs or cash hits your account, transactions will appear here.",badge:d||m?"Filters applied":"Queue clear",actions:e.jsxs(e.Fragment,{children:[(d||m)&&e.jsx(u,{size:"sm",variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",onClick:()=>{y(""),j(""),x()},children:"Reset filters"}),e.jsx(C,{to:"/orders",children:e.jsx(u,{size:"sm",className:"bg-gradient-primary text-primary-foreground",children:"Review pending orders"})})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(R,{children:[e.jsx(L,{children:e.jsxs(h,{children:[e.jsx(n,{children:"ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Order Code"}),e.jsx(n,{children:"Asset"}),e.jsx(n,{children:"Amount"}),e.jsxs(n,{children:["Value (",a,")"]}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Completed At"}),e.jsx(n,{children:"Proof"})]})}),e.jsx(B,{children:N.map(s=>e.jsxs(h,{className:"hover:bg-muted/40",children:[e.jsx(c,{children:e.jsx(C,{to:`/transactions/${s.id}`,className:"text-primary underline",children:String(s.id).padStart(4,"0")})}),e.jsx(c,{className:"capitalize",children:s.order_type||"-"}),e.jsx(c,{children:s.order_code||s.order}),e.jsx(c,{children:s.order_asset||"-"}),e.jsx(c,{children:s.order_amount??"-"}),e.jsx(c,{children:s.order_total_value!=null?q(Number(s.order_total_value),a):"-"}),e.jsx(c,{children:E(s.status)}),e.jsx(c,{className:"text-muted-foreground",children:s.completed_at?new Date(s.completed_at).toLocaleString():"-"}),e.jsx(c,{children:s.proof?"Yes":"No"})]},s.id))})]})})]})]})]})})};export{se as default};
