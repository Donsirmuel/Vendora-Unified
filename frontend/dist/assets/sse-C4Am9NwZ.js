import{b as f}from"./main-BnmLXDMO.js";function g(u="/api/v1/stream/",o={}){let t=null,i=!1,n=1e3;const s=()=>{if(i)return;const p=new URL(u,window.location.origin),r=f();r&&p.searchParams.set("token",r),t=new EventSource(p.toString(),{withCredentials:!1}),t.onopen=()=>{var e;n=1e3,(e=o.onOpen)==null||e.call(o)},t.onerror=e=>{var c;(c=o.onError)==null||c.call(o,e);try{t==null||t.close()}catch{}t=null,i||(setTimeout(s,n),n=Math.min(n*2,3e4))},t.addEventListener("snapshot",e=>{var c;try{const a=JSON.parse(e.data);(c=o.onMessage)==null||c.call(o,{type:"snapshot",data:a})}catch{}}),t.onmessage=e=>{var c;try{const a=JSON.parse(e.data);(c=o.onMessage)==null||c.call(o,{type:"message",data:a})}catch{}}};return s(),{close:()=>{i=!0;try{t==null||t.close()}catch{}t=null}}}export{g as c};
