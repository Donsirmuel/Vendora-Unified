const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/charts_panel-DZ6GAu93.js","assets/vendor-LI3anQjP.js","assets/vendor-recharts-iVWv7ny2.js"])))=>i.map(i=>d[i]);
import{c as R,C as m,a as u,b as x,d as y,e as h,_ as me}from"./charts_panel-DZ6GAu93.js";import{r as i,j as e,b1 as ee,b2 as ue,b3 as xe,b4 as Y,b5 as E,b6 as U,b7 as G,aH as p,R as se,b8 as he,b9 as pe}from"./vendor-LI3anQjP.js";import{L as X,B as J}from"./badge-0Mmftv1n.js";import{h as Q,u as ge,a as je,B as a}from"./main-Dx6KqeX5.js";import{l as _}from"./orders-BTsnZsY7.js";import{l as fe}from"./queries-B65t_KTx.js";import{l as be}from"./broadcast-BhQ2ULP-.js";import{f as Z}from"./currency-CzyHyq4G.js";import{c as Ne}from"./sse-BitM5vLy.js";import{B as P}from"./BrandedEmptyState-3fXBKWGy.js";import"./vendor-recharts-iVWv7ny2.js";async function F(c=1,l){try{const r=new URLSearchParams;return r.append("page",c.toString()),l&&r.append("status",l),(await Q.get(`/api/v1/transactions/?${r.toString()}`)).data}catch(r){const j=r.response?.data?.detail||"Failed to load transactions";throw new Error(j)}}async function ye(){const{data:c}=await Q.get("/api/v1/accounts/vendors/onboarding/");return c}const te=i.forwardRef(({className:c,value:l,...r},j)=>e.jsx(ee,{ref:j,className:R("relative h-4 w-full overflow-hidden rounded-full bg-secondary",c),...r,children:e.jsx(ue,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(l||0)}%)`}})}));te.displayName=ee.displayName;function ve({className:c}){const{data:l,isLoading:r,isError:j,refetch:g}=xe({queryKey:["onboarding-status"],queryFn:ye,staleTime:6e4}),[L,D]=i.useState(!1),O=l?.percent??0;if(L)return null;if(r)return e.jsx("div",{className:R("rounded-md border p-4 text-xs bg-background/40",c),children:"Loading onboarding…"});if(j||!l)return e.jsx("div",{className:R("rounded-md border p-4 text-xs text-red-500 bg-background/40",c),children:"Failed to load onboarding."});if(O>=100)return null;const f=l.steps.filter(b=>!b.done).length;return e.jsxs("div",{className:R("rounded-md border p-4 bg-background/60 backdrop-blur-sm relative",c),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-sm",children:"Getting Started"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>g(),className:"text-[11px] text-muted-foreground hover:underline",children:"Refresh"}),e.jsx("button",{"aria-label":"Dismiss onboarding checklist",onClick:()=>D(!0),className:"text-muted-foreground/70 hover:text-foreground transition text-xs",children:"×"})]})]}),e.jsx(te,{value:O,className:"h-2 mb-3"}),e.jsx("ul",{className:"space-y-1 mb-3",children:l.steps.map(b=>e.jsxs("li",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:R("mt-0.5 inline-block h-3 w-3 rounded-full border shrink-0",b.done?"bg-emerald-500 border-emerald-500":"bg-transparent border-muted-foreground/40")}),e.jsx("span",{className:R("leading-snug",b.done?"line-through text-muted-foreground":""),children:b.label})]},b.id))}),e.jsx("div",{className:"text-[11px] text-muted-foreground",children:f===0?"All onboarding steps complete.":`${f} step${f===1?"":"s"} remaining.`})]})}const we=se.lazy(()=>me(()=>import("./charts_panel-DZ6GAu93.js").then(c=>c.f),__vite__mapDeps([0,1,2]))),Pe=()=>{const{user:c}=ge(),{toast:l}=je(),[r,j]=i.useState({totalOrdersReceived:0,pendingOrders:0,completedOrders:0,totalRevenue:0,completedTransactions:0,pendingQueries:0}),[g,L]=i.useState({orders:[],transactions:[],queries:[],broadcasts:[]}),[D,O]=i.useState(!0),[f,b]=i.useState([]),[v,re]=i.useState(null),[I,ae]=i.useState(null),[V,ne]=i.useState(!1),[q,$]=i.useState("USD");i.useEffect(()=>{B();const s=Ne("/api/v1/stream/",{onMessage:t=>{t.type==="snapshot"&&B()}});return()=>s.close()},[]),i.useEffect(()=>{const s=Array.from(document.querySelectorAll(".card-anim"));return s.forEach((t,o)=>setTimeout(()=>t.classList.add("show"),90*o+50)),()=>s.forEach(t=>t.classList.remove("show"))},[]),i.useEffect(()=>{(t=>"requestIdleCallback"in window?window.requestIdleCallback(t):setTimeout(t,1200))(()=>ne(!0))},[]),i.useEffect(()=>{(async()=>{try{const t=(await Q.get("/api/v1/accounts/vendors/me/")).data||{};re(t.bot_link||null),ae(t.telegram_username||null),$(t.currency||"USD")}catch{$("USD")}})()},[]);const B=async()=>{try{O(!0);const[s,t,o,w]=await Promise.all([_(1,"pending"),_(1,"accepted"),_(1,"declined"),_(1,"completed")]),T=s.results,A=t.count||0,n=o.count||0,d=w.count||0,N=[];let K=0;try{const C=await F(1,"completed");K=C.count||0;let S=C;N.push(...S.results);for(let k=2;k<=3&&S.next;k++)S=await F(k,"completed"),N.push(...S.results)}catch{}const M=N,ce=(await F(1,"uncompleted")).results,H=(await fe(1)).results.filter(C=>!C.reply||String(C.reply).trim()===""),de=(await be(1)).results.slice(0,2),oe=M.reduce((C,S)=>{const k=S.order_total_value,W=k!=null?Number(k):NaN;return C+(isFinite(W)?W:0)},0);j({totalOrdersReceived:A+n,pendingOrders:s.count||0,completedOrders:d,totalRevenue:oe,completedTransactions:K,pendingQueries:H.length}),b(M),L({orders:T.slice(0,3),transactions:ce.slice(0,3),queries:H.slice(0,3),broadcasts:de})}catch(s){console.error("Error loading dashboard data:",s)}finally{O(!1)}},z=s=>Z(s,q),ie=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:G},completed:{color:"bg-green-100 text-green-800",icon:pe},declined:{color:"bg-red-100 text-red-800",icon:he}},o=t[s]||t.pending,w=o.icon;return e.jsxs(J,{className:o.color,children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},le=i.useMemo(()=>{const t=new Date,o={};for(let n=13;n>=0;n--){const d=new Date(t);d.setDate(t.getDate()-n);const N=d.toISOString().slice(0,10);o[N]={revenue:0,count:0}}const w={completed:0,pending:0,failed:0};w.completed=f.length,w.pending=0;for(const n of f){if(!n.completed_at)continue;const d=n.completed_at.slice(0,10);if(!(d in o))continue;const N=n.order_total_value!=null?Number(n.order_total_value):0;o[d].revenue+=isFinite(N)?N:0,o[d].count+=1}const T=Object.entries(o).map(([n,d])=>({date:n,...d})),A=T.reduce((n,d)=>({revenue:n.revenue+d.revenue,count:n.count+d.count}),{revenue:0,count:0});return{series:T,statusCounts:w,totals:A}},[f,r.completedTransactions,r.completedOrders]);return D?e.jsx(X,{children:e.jsx("div",{className:"flex items-center justify-center h-64",role:"status","aria-live":"polite","aria-label":"Loading dashboard data",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard…"})]})})}):e.jsx(X,{children:e.jsxs("div",{className:"space-y-6 page-anim",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Vendora dashboard"}),e.jsx("div",{className:"flex items-center gap-2 ml-auto",children:e.jsx(a,{variant:"outline",className:"border-primary/40 text-primary hover:bg-primary/10",onClick:B,children:"Sync dashboard"})})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",c?.name||"vendor",". Keep buyers updated, complete payments on time, and keep records in one place."]}),e.jsx(ve,{}),v&&e.jsxs(m,{className:"card-anim",children:[e.jsxs(u,{className:"pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Share your bot link with customers"}),e.jsx(y,{children:"Customers trade via your Telegram bot, not the PWA."})]}),e.jsxs(h,{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"flex-1 truncate text-sm",children:[e.jsx("span",{className:"font-medium mr-2",children:"Link:"}),e.jsx("a",{className:"text-primary underline break-all",href:v,target:"_blank",rel:"noreferrer",children:v}),I&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(@",I,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",onClick:async()=>{try{await navigator.clipboard.writeText(v),l({title:"Copied",description:"Bot link copied to clipboard"})}catch{l({title:"Copy failed",description:"Select and copy manually",variant:"destructive"})}},children:"Copy"}),e.jsx("a",{href:v,target:"_blank",rel:"noreferrer",children:e.jsx(a,{variant:"default",children:"Open in Telegram"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(m,{className:"card-anim",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Orders received"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.totalOrdersReceived}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.pendingOrders," waiting on vendor approval"]})]})]}),e.jsxs(m,{className:"card-anim",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs(x,{className:"text-sm font-medium",children:["Settled revenue (",q,")"]}),e.jsx("span",{className:"sr-only",children:q})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:z(r.totalRevenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Driven by ",r.completedOrders," completed orders"]})]})]}),e.jsxs(m,{className:"card-anim",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Transactions released"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.completedTransactions}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," released in the latest sync"]})]})]}),e.jsxs(m,{className:"card-anim",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Buyer queries open"}),e.jsx(U,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:r.pendingQueries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require vendor response"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(m,{className:"border-border/70",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Pending Orders"})]}),e.jsx(y,{children:"Orders awaiting vendor decisioning"})]}),e.jsx(h,{children:g.orders.length>0?e.jsxs("div",{className:"space-y-3",children:[g.orders.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.asset}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.amount," ",s.asset," @ ",s.rate]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[ie(s.status),e.jsx(p,{to:`/orders/${s.id}`,children:e.jsx(a,{size:"sm",variant:"outline",children:"View"})})]})]},s.id)),e.jsx(p,{to:"/orders",children:e.jsx(a,{variant:"outline",className:"w-full",children:"View All Orders"})})]}):e.jsx(P,{icon:Y,title:"No pending orders",description:"All active orders are cleared. Publish a fresh rate card to stay ahead of demand.",badge:"All clear",actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{to:"/orders",children:e.jsx(a,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Review order history"})}),e.jsx(p,{to:"/broadcast-messages",children:e.jsx(a,{className:"bg-gradient-primary text-primary-foreground",children:"Broadcast new rate"})})]})})})]}),e.jsxs(m,{className:"border-border/70",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5"}),e.jsx("span",{children:"Latest Uncompleted Transactions"})]}),e.jsx(y,{children:"Transactions awaiting release"})]}),e.jsx(h,{children:g.transactions.length>0?e.jsxs("div",{className:"space-y-3",children:[g.transactions.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.order_asset," • ",s.order_type?.toUpperCase()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:z(Number(s.order_total_value||0))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"bg-yellow-100 text-yellow-800",children:"Uncompleted"}),e.jsx(p,{to:`/transactions/${s.id}`,children:e.jsx(a,{size:"sm",variant:"outline",children:"Open"})})]})]},s.id)),e.jsx(p,{to:"/transactions",children:e.jsx(a,{variant:"outline",className:"w-full",children:"View All Transactions"})})]}):e.jsx(P,{icon:E,title:"No transactions pending release",description:"Every buyer has been settled. Queue new deals or follow up on pipeline leads.",badge:"Settlement complete",actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{to:"/transactions",children:e.jsx(a,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Review transaction log"})}),e.jsx(p,{to:"/queries",children:e.jsx(a,{className:"bg-gradient-primary text-primary-foreground",children:"Check buyer queries"})})]})})})]}),e.jsxs(m,{className:"border-border/70",children:[e.jsxs(u,{children:[e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Queries"})]}),e.jsx(y,{children:"Buyer questions and support requests"})]}),e.jsx(h,{children:g.queries.length>0?e.jsxs("div",{className:"space-y-3",children:[g.queries.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("p",{className:"font-medium text-sm",children:[s.message.substring(0,50),"..."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Contact: ",s.contact]}),e.jsx(p,{to:"/queries",children:e.jsx(a,{size:"sm",variant:"outline",className:"mt-2",children:"Respond"})})]},s.id)),e.jsx(p,{to:"/queries",children:e.jsx(a,{variant:"outline",className:"w-full",children:"View All Queries"})})]}):e.jsx(P,{icon:U,title:"No open buyer queries",description:"Your support queue is quiet. Share your Vendora bot link to let buyers reach you 24/7.",badge:"Inbox clear",actions:e.jsxs(e.Fragment,{children:[e.jsx(p,{to:"/broadcast-messages",children:e.jsx(a,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Share availability update"})}),v&&e.jsx(a,{onClick:async()=>{try{await navigator.clipboard.writeText(v),l({title:"Copied",description:"Bot link copied to clipboard"})}catch{l({title:"Copy failed",description:"Select and copy manually",variant:"destructive"})}},className:"bg-gradient-primary text-primary-foreground",children:"Copy Vendora bot link"})]})})})]})]}),g.broadcasts.length>0&&e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Recent Broadcasts"}),e.jsx(y,{children:"Your latest announcements to customers"})]}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-3",children:[g.broadcasts.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s.content.substring(0,100),"..."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Sent: ",new Date(s.created_at).toLocaleDateString()]})]},s.id)),e.jsx(p,{to:"/broadcast-messages",children:e.jsx(a,{variant:"outline",className:"w-full",children:"Send New Broadcast"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[!V&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Completed Transactions per Day"}),e.jsx(y,{children:"Loading…"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-72 w-full animate-pulse bg-muted rounded"})})]}),e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Revenue (last 14 days)"}),e.jsx(y,{children:"Loading…"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-72 w-full animate-pulse bg-muted rounded"})})]})]}),V&&e.jsx(se.Suspense,{fallback:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(x,{children:"Charts"}),e.jsx(y,{children:"Loading…"})]}),e.jsx(h,{children:e.jsx("div",{className:"h-72 bg-muted rounded animate-pulse"})})]})}),children:e.jsx(we,{insights:le,formatCurrency:Z})})]})]})})};export{Pe as default};
