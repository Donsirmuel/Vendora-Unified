import{be as M,r as h,j as e,aH as R,aJ as V,bg as H,bh as W,aV as z,aG as k,b7 as L,bd as G}from"./vendor-C5ZIaFXU.js";import{L as S,B as N}from"./badge-CwdvftBL.js";import{C as d,a as l,b as i,d as g,e as m}from"./charts_panel-CXTnZd3F.js";import{a as J,B as v,L as K,I as X,h as p,g as f,t as q}from"./main-BnmLXDMO.js";import"./vendor-recharts-Bhh5Wr_H.js";const se=()=>{const{id:o}=M(),{toast:c}=J(),[y,w]=h.useState(!1),[_,C]=h.useState(!1),[t,j]=h.useState(null),[a,T]=h.useState(null),F="https://api.vendora.page",b=s=>s?s.startsWith("http://")||s.startsWith("https://")?s:s.startsWith("/")?`${F}${s}`:s:"";h.useEffect(()=>{(async()=>{var n;if(o)try{const r=await p.get(`/api/v1/transactions/${o}/`);if(j(r.data),(n=r.data)!=null&&n.order)try{const x=await p.get(`/api/v1/orders/${r.data.order}/`);T(x.data)}catch{}}catch(r){c({title:"Load failed",description:f(r,"Could not load transaction"),variant:"destructive"})}})()},[o]);const P=async()=>{C(!0);try{if(!o)return;const s=new FormData;s.append("status","completed");const n=await p.post(`/api/v1/transactions/${o}/complete/`,s,{headers:{"Content-Type":"multipart/form-data"}});c({title:"Transaction Completed",description:"Marked as completed.",className:"bg-success text-success-foreground"});const r=await p.get(`/api/v1/transactions/${o}/`);j(r.data)}catch(s){c({title:"Complete failed",description:f(s,"Failed to complete"),variant:"destructive"})}finally{C(!1)}},$=async s=>{const n=s.target.files;if(!(!n||n.length===0)){w(!0);try{if(!o)return;const r=new FormData;r.append("status","completed"),r.append("vendor_proof",n[0]),await p.post(`/api/v1/transactions/${o}/complete/`,r,{headers:{"Content-Type":"multipart/form-data"}}),c({title:"Proof Uploaded",description:"Vendor proof uploaded and transaction completed.",className:"bg-success text-success-foreground"});const x=await p.get(`/api/v1/transactions/${o}/`);j(x.data)}catch(r){c({title:"Upload failed",description:f(r,"Failed to upload proof"),variant:"destructive"})}finally{w(!1)}}},U=async()=>{try{if(!o)return;const s="https://api.vendora.page",n=q.getAccessToken()||"",r=await fetch(`${s}/api/v1/transactions/${o}/pdf/`,{headers:{Authorization:`Bearer ${n}`}});if(!r.ok){const O=await r.text();throw new Error(O||"Failed to generate PDF")}const x=await r.blob(),D=window.URL.createObjectURL(x),u=document.createElement("a");u.href=D,u.download=`transaction_${o}.pdf`,document.body.appendChild(u),u.click(),u.remove(),window.URL.revokeObjectURL(D)}catch(s){c({title:"PDF Error",description:f(s,"Failed to download PDF"),variant:"destructive"})}},A=s=>{switch(s){case"completed":return"bg-crypto-green/20 text-crypto-green";case"uncompleted":return"bg-warning/20 text-warning";case"declined":return"bg-destructive/20 text-destructive";case"expired":return"bg-gray-100 text-gray-800";default:return"bg-secondary text-secondary-foreground"}},B=s=>{switch(s){case"completed":return e.jsx(k,{className:"h-4 w-4"});case"uncompleted":return e.jsx(L,{className:"h-4 w-4"});case"declined":return e.jsx(G,{className:"h-4 w-4"});default:return e.jsx(L,{className:"h-4 w-4"})}},E=s=>s==="buy"?"bg-crypto-green/20 text-crypto-green":"bg-crypto-red/20 text-crypto-red",I=s=>{switch(s){case"BTC":return"bg-crypto-gold/20 text-crypto-gold";case"ETH":return"bg-crypto-blue/20 text-crypto-blue";default:return"bg-secondary text-secondary-foreground"}};return t?e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(R,{to:"/transactions",children:e.jsxs(v,{variant:"outline",size:"sm",className:"border-border",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Transactions"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Transaction Details"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete transaction information and actions"})]})]}),e.jsxs(v,{variant:"outline",onClick:U,className:"border-border",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]}),e.jsxs(d,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Transaction Overview"}),e.jsx(g,{children:"Complete details about this transaction"})]}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order ID"}),e.jsx("p",{className:"font-semibold",children:t.order_code||String(t.order).padStart(4,"0")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date"}),e.jsx("p",{className:"font-semibold",children:a!=null&&a.created_at?new Date(a.created_at).toLocaleString():t.completed_at?new Date(t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Asset"}),e.jsx(N,{className:I(t.order_asset||""),children:t.order_asset||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Amount"}),e.jsx("p",{className:"font-semibold",children:t.order_amount??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Value"}),e.jsx("p",{className:"font-semibold text-lg",children:(()=>{const s=(a==null?void 0:a.total_value)??t.order_total_value,n=s!=null?Number(s):NaN;return isFinite(n)?`â‚¦${n.toLocaleString()}`:"-"})()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(N,{className:E(t.order_type||""),children:(t.order_type||"").toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsxs(N,{className:A(t.status),children:[B(t.status),e.jsx("span",{className:"ml-1",children:t.status})]})]})]})})]}),e.jsxs(d,{className:"bg-gradient-card border-border mb-6",children:[e.jsx(l,{children:e.jsx(i,{children:"Customer Details"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Customer Receiving Details"}),e.jsx("div",{className:"p-3 bg-secondary/50 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.customer_receiving_details||"-"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Customer Note"}),e.jsx("div",{className:"p-3 bg-secondary/50 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.customer_note||"-"})})]})]})]}),e.jsxs(d,{className:"bg-gradient-card border-border mb-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Customer Proof of Transaction"}),e.jsx(g,{children:"Payment proof uploaded by customer"})]}),e.jsx(m,{children:(()=>{const s=b(t.proof||t.proof_of_payment||t.customer_proof||null);return s?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 border rounded-lg bg-secondary/30",children:e.jsx("img",{src:s,alt:"Customer proof",className:"max-h-96 object-contain mx-auto"})}),e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-sm underline text-primary",children:"Open original"})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(W,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No customer proof uploaded yet"})]})})()})]}),t.status!=="declined"&&e.jsxs(d,{className:"bg-gradient-card border-border mb-6",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Vendor Actions"}),e.jsx(g,{children:"Available actions for this transaction"})]}),e.jsxs(m,{className:"space-y-4",children:[t.status==="uncompleted"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{onClick:P,disabled:_,className:"w-full bg-gradient-success hover:opacity-90",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),_?"Processing...":"Mark as Completed"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"proof-upload",className:"text-sm font-medium",children:"Upload Proof of Transaction"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{id:"proof-upload",type:"file",accept:"image/*",onChange:$,disabled:y,className:"bg-background border-border file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-primary file:text-primary-foreground hover:file:opacity-90"}),y&&e.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-md",children:e.jsx("div",{className:"text-sm",children:"Uploading..."})})]})]})]}),t.status==="completed"&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx(k,{className:"h-12 w-12 text-success mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Transaction completed successfully"})]})]})]}),e.jsxs(d,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Transaction Timeline"}),e.jsx(g,{children:"Key timestamps for this transaction"})]}),e.jsx(m,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsx("p",{className:"font-medium",children:a!=null&&a.created_at?new Date(a.created_at).toLocaleString():t.completed_at?new Date(t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Accepted"}),e.jsx("p",{className:"font-medium",children:a!=null&&a.accepted_at?new Date(a.accepted_at).toLocaleString():(a==null?void 0:a.status)==="completed"&&(t.vendor_completed_at||t.completed_at)?new Date(t.vendor_completed_at||t.completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"}),e.jsx("p",{className:"font-medium",children:t.vendor_completed_at?new Date(t.vendor_completed_at).toLocaleString():"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Declined"}),e.jsx("p",{className:"font-medium",children:a!=null&&a.declined_at?new Date(a.declined_at).toLocaleString():t.status==="declined"&&(t.completed_at||a!=null&&a.updated_at)?new Date(t.completed_at||(a==null?void 0:a.updated_at)).toLocaleString():"-"})]})]})})]}),t.status!=="declined"&&e.jsxs(d,{className:"bg-gradient-card border-border",children:[e.jsxs(l,{children:[e.jsx(i,{children:"Vendor Proof of Completion"}),e.jsx(g,{children:"Proof images uploaded by you"})]}),e.jsx(m,{children:t.vendor_proof?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 border rounded-lg bg-secondary/30",children:e.jsx("img",{src:b(t.vendor_proof),alt:"Vendor proof",className:"max-h-96 object-contain mx-auto"})}),e.jsx("a",{href:b(t.vendor_proof),target:"_blank",rel:"noreferrer",className:"text-sm underline text-primary",children:"Open original"})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No vendor proof uploaded yet"})})]})]})}):e.jsx(S,{children:e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loadingâ€¦"})})};export{se as default};
