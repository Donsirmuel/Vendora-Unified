import{bD as ie,bE as ne,r as i,j as e,bF as de,bG as $,bH as P,bI as G,bJ as _,bK as J,bL as K,bc as oe,b6 as b,aH as ce,aG as me,b7 as xe,b8 as pe}from"./vendor-C5ZIaFXU.js";import{L as ue,B as he}from"./badge-CwdvftBL.js";import{c as o,C as v,a as Q,b as ge,d as je,e as N}from"./charts_panel-CXTnZd3F.js";import{j as Y,a as fe,B as d,I as ye,h as w,g}from"./main-BnmLXDMO.js";import{T as be}from"./textarea-B39yKq_J.js";import{S as ve,a as Ne,b as we,c as Ce,d as j}from"./select-D7oLnaqY.js";import{d as H}from"./queries-DoRl4NRH.js";import{B as De}from"./BrandedEmptyState-Dd66voyI.js";import"./vendor-recharts-Bhh5Wr_H.js";const V=ie,M=ne,Se=de,U=i.forwardRef(({className:t,...r},l)=>e.jsx(K,{className:o("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:l}));U.displayName=K.displayName;const C=i.forwardRef(({className:t,...r},l)=>e.jsxs(Se,{children:[e.jsx(U,{}),e.jsx($,{ref:l,className:o("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]}));C.displayName=$.displayName;const D=({className:t,...r})=>e.jsx("div",{className:o("flex flex-col space-y-2 text-center sm:text-left",t),...r});D.displayName="AlertDialogHeader";const S=({className:t,...r})=>e.jsx("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});S.displayName="AlertDialogFooter";const A=i.forwardRef(({className:t,...r},l)=>e.jsx(P,{ref:l,className:o("text-lg font-semibold",t),...r}));A.displayName=P.displayName;const k=i.forwardRef(({className:t,...r},l)=>e.jsx(G,{ref:l,className:o("text-sm text-muted-foreground",t),...r}));k.displayName=G.displayName;const T=i.forwardRef(({className:t,...r},l)=>e.jsx(J,{ref:l,className:o(Y(),t),...r}));T.displayName=J.displayName;const R=i.forwardRef(({className:t,...r},l)=>e.jsx(_,{ref:l,className:o(Y({variant:"outline"}),"mt-2 sm:mt-0",t),...r}));R.displayName=_.displayName;const Be=()=>{const[t,r]=i.useState(""),[l,F]=i.useState("all"),[u,x]=i.useState([]),[W,I]=i.useState(!0),[X,f]=i.useState(null),[L,h]=i.useState(""),[z,O]=i.useState(!1),[Z,y]=i.useState(null),[q,B]=i.useState(!1),{toast:n}=fe();i.useEffect(()=>{(async()=>{try{I(!0);const a=await w.get("/api/v1/queries/");x(a.data.results||[])}catch(a){x([]),n({title:"Failed",description:g(a,"Failed to load queries"),variant:"destructive"})}finally{I(!1)}})()},[]);async function ee(s){try{await H(s),x(a=>a.filter(c=>c.id!==s)),n({title:"Deleted",description:`Query ${s} was deleted.`})}catch(a){console.error(a),n({title:"Delete failed",description:g(a,"Failed to delete query"),variant:"destructive"})}finally{y(null)}}async function se(){O(!0);try{for(const s of u)await H(s.id);x([]),n({title:"Deleted",description:"All queries were deleted."})}catch(s){console.error(s),n({title:"Delete all failed",description:g(s,"Failed to delete all queries"),variant:"destructive"})}finally{O(!1),B(!1)}}const te=async s=>{try{const c=(await w.patch(`/api/v1/queries/${s}/`,{reply:L})).data;x(p=>p.map(m=>m.id===s?{...m,...c}:m)),f(null),h(""),n({title:"Reply sent",description:"Your response was saved."})}catch{}},ae=async s=>{try{const c=(await w.post(`/api/v1/queries/${s}/mark_done/`)).data;x(p=>p.map(m=>m.id===s?{...m,...c}:m)),n({title:"Marked as done",description:"Customer will be notified via Telegram."})}catch(a){n({title:"Failed",description:g(a,"Could not mark as done"),variant:"destructive"})}},le=s=>{switch(s){case"pending":return"bg-warning/20 text-warning";case"replied":return"bg-primary/20 text-primary";case"resolved":return"bg-crypto-green/20 text-crypto-green";default:return"bg-secondary text-secondary-foreground"}},re=s=>{switch(s){case"pending":return e.jsx(pe,{className:"h-4 w-4"});case"replied":return e.jsx(xe,{className:"h-4 w-4"});case"resolved":return e.jsx(me,{className:"h-4 w-4"});default:return e.jsx(b,{className:"h-4 w-4"})}},E=u.filter(s=>{const a=String(s.status||(s.reply&&String(s.reply).trim().length>0?"replied":"pending")),c=(s.message||"").toLowerCase().includes(t.toLowerCase())||String(s.id).includes(t),p=l==="all"||a===l.toLowerCase();return c&&p});return e.jsx(ue,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Buyer support queue"}),e.jsx("p",{className:"text-muted-foreground",children:"Reply to buyers, log resolutions, and keep your Vendora bot conversations tidy."})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs(V,{open:q,onOpenChange:B,children:[e.jsx(M,{asChild:!0,children:e.jsx(d,{variant:"destructive",disabled:z||u.length===0,children:z?"Deleting...":`Delete all (${u.length})`})}),e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsx(A,{children:"Delete all queries"}),e.jsx(k,{children:"This will permanently delete all customer queries. This action cannot be undone."})]}),e.jsxs(S,{children:[e.jsx(R,{children:"Cancel"}),e.jsx(T,{onClick:se,children:"Delete all"})]})]})]})})]}),e.jsxs(v,{className:"border-border/70",children:[e.jsxs(Q,{children:[e.jsx(ge,{className:"text-lg font-semibold text-white",children:"Filter buyer conversations"}),e.jsx(je,{children:"Search by keyword, status, or triage level."})]}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{placeholder:"Search queries...",value:t,onChange:s=>r(s.target.value),className:"pl-10 bg-background border-border"}),e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),e.jsxs(ve,{value:l,onValueChange:F,children:[e.jsx(Ne,{className:"bg-background border-border",children:e.jsx(we,{placeholder:"Filter by status"})}),e.jsxs(Ce,{children:[e.jsx(j,{value:"all",children:"All Statuses"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"replied",children:"Replied"}),e.jsx(j,{value:"resolved",children:"Resolved"})]})]}),e.jsx("div",{})]})})]}),e.jsx("div",{className:"space-y-4",children:W?e.jsx(v,{className:"border-border/70",children:e.jsx(N,{className:"text-center py-12 text-muted-foreground",children:"Loading queries…"})}):E.length>0?E.map(s=>e.jsxs(v,{className:"bg-gradient-card border-border hover:shadow-lg transition-shadow",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:"font-semibold",children:"Customer Query"})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Query ID: ",s.id]}),s.order&&e.jsxs("span",{children:["Order: ",s.order]})]})]}),(()=>{const a=String(s.status||(s.reply&&String(s.reply).trim().length>0?"replied":"pending"));return e.jsxs(he,{className:le(a),children:[re(a),e.jsx("span",{className:"ml-1",children:a})]})})()]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm",children:s.message}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Created: ",new Date(s.created_at||s.timestamp||Date.now()).toLocaleString()]}),e.jsxs("div",{className:"space-x-2",children:[X===s.id?e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[e.jsx(be,{value:L,onChange:a=>h(a.target.value),placeholder:"Type your reply…",className:"min-w-[240px]"}),e.jsx(d,{size:"sm",onClick:()=>te(s.id),children:"Send"}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>{f(null),h("")},children:"Cancel"})]}):e.jsxs(d,{variant:"outline",size:"sm",className:"border-border",onClick:()=>{f(s.id),h(s.reply||"")},children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Reply"]}),e.jsx(d,{size:"sm",onClick:()=>ae(s.id),children:"Mark as done"}),e.jsxs(V,{open:Z===s.id,onOpenChange:a=>{a||y(null)},children:[e.jsx(M,{asChild:!0,children:e.jsx(d,{size:"sm",variant:"outline",onClick:()=>y(s.id),children:"🗑️"})}),e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsxs(A,{children:["Delete query ",s.id,"?"]}),e.jsx(k,{children:"This will permanently delete the query. This action cannot be undone."})]}),e.jsxs(S,{children:[e.jsx(R,{children:"Cancel"}),e.jsx(T,{onClick:()=>ee(s.id),children:"Delete"})]})]})]})]})]})]})})]},s.id)):e.jsx(De,{icon:b,title:t||l!=="all"?"No buyer conversations match":"Support queue is quiet",description:t||l!=="all"?"Reset your filters to see every buyer conversation awaiting a follow-up.":"Buyers can reach you via your Vendora bot. Share the link to invite new conversations.",badge:t||l!=="all"?"Filters applied":"All clear",actions:e.jsxs(e.Fragment,{children:[(t||l!=="all")&&e.jsx(d,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",onClick:()=>{r(""),F("all")},children:"Clear filters"}),e.jsx(ce,{to:"/broadcast-messages",children:e.jsx(d,{className:"bg-gradient-primary text-primary-foreground",children:"Send availability update"})})]})})})]})})};export{Be as default};
