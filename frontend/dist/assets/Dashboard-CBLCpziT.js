const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/charts_panel-CXTnZd3F.js","assets/vendor-C5ZIaFXU.js","assets/vendor-recharts-Bhh5Wr_H.js"])))=>i.map(i=>d[i]);
import{c as O,C as u,a as x,b as h,d as v,e as p,_ as ce}from"./charts_panel-CXTnZd3F.js";import{r as d,j as e,b1 as X,b2 as de,b3 as oe,b4 as G,b5 as D,b6 as E,b7 as H,aH as g,R as J,b8 as me,b9 as ue}from"./vendor-C5ZIaFXU.js";import{L as W,B as Y}from"./badge-CwdvftBL.js";import{h as Q,u as xe,a as he,B as n}from"./main-BnmLXDMO.js";import{l as L}from"./orders-BRpWy8Bz.js";import{l as pe}from"./queries-DoRl4NRH.js";import{l as ge}from"./broadcast-Dzh1RArE.js";import{c as je}from"./sse-C4Am9NwZ.js";import{B as P}from"./BrandedEmptyState-Dd66voyI.js";import"./vendor-recharts-Bhh5Wr_H.js";async function F(i=1,r){var l,j;try{const a=new URLSearchParams;return a.append("page",i.toString()),r&&a.append("status",r),(await Q.get(`/api/v1/transactions/?${a.toString()}`)).data}catch(a){const S=((j=(l=a.response)==null?void 0:l.data)==null?void 0:j.detail)||"Failed to load transactions";throw new Error(S)}}async function fe(){const{data:i}=await Q.get("/api/v1/accounts/vendors/onboarding/");return i}const Z=d.forwardRef(({className:i,value:r,...l},j)=>e.jsx(X,{ref:j,className:O("relative h-4 w-full overflow-hidden rounded-full bg-secondary",i),...l,children:e.jsx(de,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));Z.displayName=X.displayName;function be({className:i}){const{data:r,isLoading:l,isError:j,refetch:a}=oe({queryKey:["onboarding-status"],queryFn:fe,staleTime:6e4}),[S,q]=d.useState(!1),T=(r==null?void 0:r.percent)??0;if(S)return null;if(l)return e.jsx("div",{className:O("rounded-md border p-4 text-xs bg-background/40",i),children:"Loading onboarding…"});if(j||!r)return e.jsx("div",{className:O("rounded-md border p-4 text-xs text-red-500 bg-background/40",i),children:"Failed to load onboarding."});if(T>=100)return null;const f=r.steps.filter(b=>!b.done).length;return e.jsxs("div",{className:O("rounded-md border p-4 bg-background/60 backdrop-blur-sm relative",i),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium text-sm",children:"Getting Started"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(),className:"text-[11px] text-muted-foreground hover:underline",children:"Refresh"}),e.jsx("button",{"aria-label":"Dismiss onboarding checklist",onClick:()=>q(!0),className:"text-muted-foreground/70 hover:text-foreground transition text-xs",children:"×"})]})]}),e.jsx(Z,{value:T,className:"h-2 mb-3"}),e.jsx("ul",{className:"space-y-1 mb-3",children:r.steps.map(b=>e.jsxs("li",{className:"flex items-start gap-2 text-xs",children:[e.jsx("span",{className:O("mt-0.5 inline-block h-3 w-3 rounded-full border shrink-0",b.done?"bg-emerald-500 border-emerald-500":"bg-transparent border-muted-foreground/40")}),e.jsx("span",{className:O("leading-snug",b.done?"line-through text-muted-foreground":""),children:b.label})]},b.id))}),e.jsx("div",{className:"text-[11px] text-muted-foreground",children:f===0?"All onboarding steps complete.":`${f} step${f===1?"":"s"} remaining.`})]})}const Ne=J.lazy(()=>ce(()=>import("./charts_panel-CXTnZd3F.js").then(i=>i.f),__vite__mapDeps([0,1,2]))),Ae=()=>{const{user:i}=xe(),{toast:r}=he(),[l,j]=d.useState({totalOrdersReceived:0,pendingOrders:0,completedOrders:0,totalRevenue:0,completedTransactions:0,pendingQueries:0}),[a,S]=d.useState({orders:[],transactions:[],queries:[],broadcasts:[]}),[q,T]=d.useState(!0),[f,b]=d.useState([]),[y,ee]=d.useState(null),[I,se]=d.useState(null),[V,te]=d.useState(!1);d.useEffect(()=>{B();const s=je("/api/v1/stream/",{onMessage:t=>{t.type==="snapshot"&&B()}});return()=>s.close()},[]),d.useEffect(()=>{const s=Array.from(document.querySelectorAll(".card-anim"));return s.forEach((t,m)=>setTimeout(()=>t.classList.add("show"),90*m+50)),()=>s.forEach(t=>t.classList.remove("show"))},[]),d.useEffect(()=>{(t=>"requestIdleCallback"in window?window.requestIdleCallback(t):setTimeout(t,1200))(()=>te(!0))},[]),d.useEffect(()=>{(async()=>{try{const t=(await Q.get("/api/v1/accounts/vendors/me/")).data||{};ee(t.bot_link||null),se(t.telegram_username||null)}catch{}})()},[]);const B=async()=>{try{T(!0);const[s,t,m,w]=await Promise.all([L(1,"pending"),L(1,"accepted"),L(1,"declined"),L(1,"completed")]),_=s.results,A=t.count||0,c=m.count||0,o=w.count||0,N=[];let $=0;try{const C=await F(1,"completed");$=C.count||0;let k=C;N.push(...k.results);for(let R=2;R<=3&&k.next;R++)k=await F(R,"completed"),N.push(...k.results)}catch{}const z=N,ne=(await F(1,"uncompleted")).results,K=(await pe(1)).results.filter(C=>!C.reply||String(C.reply).trim()===""),ie=(await ge(1)).results.slice(0,2),le=z.reduce((C,k)=>{const R=k.order_total_value,M=R!=null?Number(R):NaN;return C+(isFinite(M)?M:0)},0);j({totalOrdersReceived:A+c,pendingOrders:s.count||0,completedOrders:o,totalRevenue:le,completedTransactions:$,pendingQueries:K.length}),b(z),S({orders:_.slice(0,3),transactions:ne.slice(0,3),queries:K.slice(0,3),broadcasts:ie})}catch(s){console.error("Error loading dashboard data:",s)}finally{T(!1)}},U=s=>`₦${Number(s||0).toLocaleString()}`,re=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:H},completed:{color:"bg-green-100 text-green-800",icon:ue},declined:{color:"bg-red-100 text-red-800",icon:me}},m=t[s]||t.pending,w=m.icon;return e.jsxs(Y,{className:m.color,children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),s.charAt(0).toUpperCase()+s.slice(1)]})},ae=d.useMemo(()=>{const t=new Date,m={};for(let c=13;c>=0;c--){const o=new Date(t);o.setDate(t.getDate()-c);const N=o.toISOString().slice(0,10);m[N]={revenue:0,count:0}}const w={completed:0,pending:0,failed:0};w.completed=f.length,w.pending=0;for(const c of f){if(!c.completed_at)continue;const o=c.completed_at.slice(0,10);if(!(o in m))continue;const N=c.order_total_value!=null?Number(c.order_total_value):0;m[o].revenue+=isFinite(N)?N:0,m[o].count+=1}const _=Object.entries(m).map(([c,o])=>({date:c,...o})),A=_.reduce((c,o)=>({revenue:c.revenue+o.revenue,count:c.count+o.count}),{revenue:0,count:0});return{series:_,statusCounts:w,totals:A}},[f,l.completedTransactions,l.completedOrders]);return q?e.jsx(W,{children:e.jsx("div",{className:"flex items-center justify-center h-64",role:"status","aria-live":"polite","aria-label":"Loading dashboard data",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4","aria-hidden":"true"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading dashboard…"})]})})}):e.jsx(W,{children:e.jsxs("div",{className:"space-y-6 page-anim",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Vendora command center"}),e.jsx("div",{className:"flex items-center gap-2 ml-auto",children:e.jsx(n,{variant:"outline",className:"border-primary/40 text-primary hover:bg-primary/10",onClick:B,children:"Sync desk data"})})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome back, ",(i==null?void 0:i.name)||"vendor",". Keep buyers updated, release settlements on time, and stay audit-ready from one console."]}),e.jsx(be,{}),y&&e.jsxs(u,{className:"card-anim",children:[e.jsxs(x,{className:"pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Share your bot link with customers"}),e.jsx(v,{children:"Customers trade via your Telegram bot, not the PWA."})]}),e.jsxs(p,{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"flex-1 truncate text-sm",children:[e.jsx("span",{className:"font-medium mr-2",children:"Link:"}),e.jsx("a",{className:"text-primary underline break-all",href:y,target:"_blank",rel:"noreferrer",children:y}),I&&e.jsxs("span",{className:"ml-2 text-xs text-muted-foreground",children:["(@",I,")"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",onClick:async()=>{try{await navigator.clipboard.writeText(y),r({title:"Copied",description:"Bot link copied to clipboard"})}catch{r({title:"Copy failed",description:"Select and copy manually",variant:"destructive"})}},children:"Copy"}),e.jsx("a",{href:y,target:"_blank",rel:"noreferrer",children:e.jsx(n,{variant:"default",children:"Open in Telegram"})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(u,{className:"card-anim",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Orders received"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalOrdersReceived}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.pendingOrders," waiting on vendor approval"]})]})]}),e.jsxs(u,{className:"card-anim",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Settled revenue (₦)"}),e.jsx("span",{className:"sr-only",children:"NGN"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:U(l.totalRevenue)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Driven by ",l.completedOrders," completed orders"]})]})]}),e.jsxs(u,{className:"card-anim",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Transactions released"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.completedTransactions}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," released in the latest sync"]})]})]}),e.jsxs(u,{className:"card-anim",children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Buyer queries open"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.pendingQueries}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Require vendor response"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(u,{className:"border-border/70",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Pending Orders"})]}),e.jsx(v,{children:"Orders awaiting vendor decisioning"})]}),e.jsx(p,{children:a.orders.length>0?e.jsxs("div",{className:"space-y-3",children:[a.orders.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.asset}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.amount," ",s.asset," @ ",s.rate]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[re(s.status),e.jsx(g,{to:`/orders/${s.id}`,children:e.jsx(n,{size:"sm",variant:"outline",children:"View"})})]})]},s.id)),e.jsx(g,{to:"/orders",children:e.jsx(n,{variant:"outline",className:"w-full",children:"View All Orders"})})]}):e.jsx(P,{icon:G,title:"No pending orders",description:"All active orders are cleared. Publish a fresh rate card to stay ahead of demand.",badge:"All clear",actions:e.jsxs(e.Fragment,{children:[e.jsx(g,{to:"/orders",children:e.jsx(n,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Review order history"})}),e.jsx(g,{to:"/broadcast-messages",children:e.jsx(n,{className:"bg-gradient-primary text-primary-foreground",children:"Broadcast new rate"})})]})})})]}),e.jsxs(u,{className:"border-border/70",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{children:"Latest Uncompleted Transactions"})]}),e.jsx(v,{children:"Transactions awaiting release"})]}),e.jsx(p,{children:a.transactions.length>0?e.jsxs("div",{className:"space-y-3",children:[a.transactions.map(s=>{var t;return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.order_asset," • ",(t=s.order_type)==null?void 0:t.toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["₦",Number(s.order_total_value||0).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"bg-yellow-100 text-yellow-800",children:"Uncompleted"}),e.jsx(g,{to:`/transactions/${s.id}`,children:e.jsx(n,{size:"sm",variant:"outline",children:"Open"})})]})]},s.id)}),e.jsx(g,{to:"/transactions",children:e.jsx(n,{variant:"outline",className:"w-full",children:"View All Transactions"})})]}):e.jsx(P,{icon:D,title:"No transactions pending release",description:"Every buyer has been settled. Queue new deals or follow up on pipeline leads.",badge:"Settlement complete",actions:e.jsxs(e.Fragment,{children:[e.jsx(g,{to:"/transactions",children:e.jsx(n,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Review transaction log"})}),e.jsx(g,{to:"/queries",children:e.jsx(n,{className:"bg-gradient-primary text-primary-foreground",children:"Check buyer queries"})})]})})})]}),e.jsxs(u,{className:"border-border/70",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Queries"})]}),e.jsx(v,{children:"Buyer questions and support requests"})]}),e.jsx(p,{children:a.queries.length>0?e.jsxs("div",{className:"space-y-3",children:[a.queries.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("p",{className:"font-medium text-sm",children:[s.message.substring(0,50),"..."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Contact: ",s.contact]}),e.jsx(g,{to:"/queries",children:e.jsx(n,{size:"sm",variant:"outline",className:"mt-2",children:"Respond"})})]},s.id)),e.jsx(g,{to:"/queries",children:e.jsx(n,{variant:"outline",className:"w-full",children:"View All Queries"})})]}):e.jsx(P,{icon:E,title:"No open buyer queries",description:"Your support queue is quiet. Share your Vendora bot link to let buyers reach you 24/7.",badge:"Inbox clear",actions:e.jsxs(e.Fragment,{children:[e.jsx(g,{to:"/broadcast-messages",children:e.jsx(n,{variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Share availability update"})}),y&&e.jsx(n,{onClick:async()=>{try{await navigator.clipboard.writeText(y),r({title:"Copied",description:"Bot link copied to clipboard"})}catch{r({title:"Copy failed",description:"Select and copy manually",variant:"destructive"})}},className:"bg-gradient-primary text-primary-foreground",children:"Copy Vendora bot link"})]})})})]})]}),a.broadcasts.length>0&&e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Recent Broadcasts"}),e.jsx(v,{children:"Your latest announcements to customers"})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-3",children:[a.broadcasts.map(s=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("h4",{className:"font-medium",children:s.title}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s.content.substring(0,100),"..."]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Sent: ",new Date(s.created_at).toLocaleDateString()]})]},s.id)),e.jsx(g,{to:"/broadcast-messages",children:e.jsx(n,{variant:"outline",className:"w-full",children:"Send New Broadcast"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[!V&&e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Completed Transactions per Day"}),e.jsx(v,{children:"Loading…"})]}),e.jsx(p,{children:e.jsx("div",{className:"h-72 w-full animate-pulse bg-muted rounded"})})]}),e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Revenue (last 14 days)"}),e.jsx(v,{children:"Loading…"})]}),e.jsx(p,{children:e.jsx("div",{className:"h-72 w-full animate-pulse bg-muted rounded"})})]})]}),V&&e.jsx(J.Suspense,{fallback:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Charts"}),e.jsx(v,{children:"Loading…"})]}),e.jsx(p,{children:e.jsx("div",{className:"h-72 bg-muted rounded animate-pulse"})})]})}),children:e.jsx(Ne,{insights:ae,formatCurrency:U})})]})]})})};export{Ae as default};
