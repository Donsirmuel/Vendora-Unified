import{r,j as e,ba as M,bb as z,bc as H,aH as L,b4 as q,b9 as O,b8 as U,bd as $,b7 as W}from"./vendor-C5ZIaFXU.js";import{L as A,B as X}from"./badge-CwdvftBL.js";import{C as k,a as G,b as J,e as E}from"./charts_panel-CXTnZd3F.js";import{a as K,g as b,B as n,I as Q}from"./main-BnmLXDMO.js";import{S as Y,a as Z,b as ee,c as se,d as c}from"./select-D7oLnaqY.js";import{l as te,a as ae,d as re}from"./orders-BRpWy8Bz.js";import{c as ie}from"./sse-C4Am9NwZ.js";import{F as le,a as ne}from"./FreePlanComponents-CbscB5Hd.js";import{B as ce}from"./BrandedEmptyState-Dd66voyI.js";import"./vendor-recharts-Bhh5Wr_H.js";const be=()=>{const{toast:d}=K(),[h,m]=r.useState([]),[p,F]=r.useState([]),[g,v]=r.useState(!0),[i,N]=r.useState(""),[l,y]=r.useState("pending"),[x,j]=r.useState(1),[B,I]=r.useState(!0),[C,u]=r.useState(null);r.useEffect(()=>{f();const s=ie("/api/v1/stream/",{onMessage:t=>{t.type==="snapshot"&&(j(1),f())}});return()=>s.close()},[x]),r.useEffect(()=>{D()},[h,i,l]);const f=async()=>{try{v(!0);const s=await te(x,"pending");m(x===1?s.results:t=>[...t,...s.results]),I(!!s.next)}catch(s){d({title:"Error",description:b(s,"Failed to load orders"),className:"bg-destructive text-destructive-foreground"})}finally{v(!1)}},D=()=>{let s=[...h];if(l!=="all"&&(s=s.filter(t=>t.status===l)),i){const t=i.toLowerCase();s=s.filter(a=>a.asset&&a.asset.toLowerCase().includes(t)||a.type&&a.type.toLowerCase().includes(t)||String(a.amount).toLowerCase().includes(t)||a.rate!==void 0&&String(a.rate).toLowerCase().includes(t))}F(s)},T=s=>{const t={pending:{color:"bg-yellow-100 text-yellow-800",icon:W,text:"Pending"},accepted:{color:"bg-blue-100 text-blue-800",icon:O,text:"Accepted"},declined:{color:"bg-red-100 text-red-800",icon:$,text:"Declined"},expired:{color:"bg-gray-100 text-gray-800",icon:U,text:"Expired"},completed:{color:"bg-green-100 text-green-800",icon:O,text:"Completed"}},a=t[s]||t.pending,o=a.icon;return e.jsxs(X,{className:a.color,children:[e.jsx(o,{className:"h-3 w-3 mr-1"}),a.text]})},R=s=>new Date(s).toLocaleString(),P=s=>s==="buy"?e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-semibold text-sm",children:"B"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 font-semibold text-sm",children:"S"})}),w=()=>{j(1),N(""),y("pending"),f()},V=async s=>{try{u(s.id);const t=await ae(s.id,{});m(a=>a.filter(o=>o.id!==s.id)),d({title:"Accepted",description:"Order accepted and customer notified."})}catch(t){d({title:"Accept failed",description:b(t,"Could not accept order"),variant:"destructive"})}finally{u(null)}},_=async s=>{try{u(s.id);const t=window.prompt("Enter reason for declining:")||"No reason provided",a=await re(s.id,{rejection_reason:t});m(o=>o.map(S=>S.id===s.id?a:S)),d({title:"Declined",description:"Customer notified of decline."})}catch(t){d({title:"Decline failed",description:b(t,"Could not decline order"),variant:"destructive"})}finally{u(null)}};return g&&x===1?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading orders..."})]})})}):e.jsx(A,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(le,{}),e.jsx(ne,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Orders desk"}),e.jsx("p",{className:"text-muted-foreground",children:"Approve buyers, trigger settlements, and keep OTC deals flowing in real time."})]}),e.jsxs(n,{onClick:w,variant:"outline",className:"border-primary/40 text-primary hover:bg-primary/10",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Resync pending orders"]})]}),e.jsxs(k,{className:"border-border/70",children:[e.jsx(G,{children:e.jsxs(J,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{children:"Filters"})]})}),e.jsx(E,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Search orders...",value:i,onChange:s=>N(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(Y,{value:l,onValueChange:y,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"All statuses"})}),e.jsxs(se,{children:[e.jsx(c,{value:"all",children:"All Statuses"}),e.jsx(c,{value:"pending",children:"Pending"}),e.jsx(c,{value:"accepted",children:"Accepted"}),e.jsx(c,{value:"declined",children:"Declined"}),e.jsx(c,{value:"expired",children:"Expired"}),e.jsx(c,{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Results"}),e.jsxs("div",{className:"text-sm text-muted-foreground pt-2",children:[p.length," of ",h.length," orders"]})]})]})})]}),e.jsx("div",{className:"space-y-4",children:p.length>0?p.map(s=>e.jsx(k,{className:"hover:shadow-md transition-shadow",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4",children:[P(s.type),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[s.asset," ",s.type.toUpperCase()]}),T(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Amount:"}),e.jsxs("p",{className:"font-medium",children:[s.amount," ",s.asset]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Rate:"}),e.jsxs("p",{className:"font-medium",children:["₦",Number(s.rate||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Value:"}),e.jsx("p",{className:"font-medium",children:s.total_value!=null?`₦${Number(s.total_value||0).toLocaleString()}`:"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("p",{className:"font-medium",children:R(s.created_at)})]})]}),s.rejection_reason&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-700",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",s.rejection_reason]})})]})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(L,{to:`/orders/${s.id}`,children:e.jsx(n,{variant:"outline",size:"sm",children:"View Details"})}),s.status==="pending"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>V(s),disabled:C===s.id,children:"Accept"}),e.jsx(n,{size:"sm",variant:"destructive",onClick:()=>_(s),disabled:C===s.id,children:"Decline"})]})]})]})})},s.id)):e.jsx(ce,{icon:q,title:i||l!=="all"?"No orders match your filters":"No orders waiting on you",description:i||l!=="all"?"Reset your filters to view the latest buyer requests waiting in Vendora.":"Share your Vendora bot link or broadcast fresh rates to bring in new OTC orders.",badge:i||l!=="all"?"Filters applied":"Inbox clear",actions:e.jsxs(e.Fragment,{children:[(i||l!=="all")&&e.jsx(n,{onClick:w,variant:"secondary",className:"bg-white/10 text-white hover:bg-white/20",children:"Clear filters"}),e.jsx(L,{to:"/broadcast-messages",children:e.jsx(n,{className:"bg-gradient-primary text-primary-foreground",children:"Broadcast updated rates"})})]})})}),B&&e.jsx("div",{className:"flex justify-center",children:e.jsx(n,{onClick:()=>j(s=>s+1),disabled:g,variant:"outline",children:g?"Loading...":"Load More Orders"})})]})})};export{be as default};
